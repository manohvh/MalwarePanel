import os, threading

class Tunnel(object):
    """ Use npm's 'localtunnel' to host panel across the internet (default port: 5000)"""

    def __init__(self, panel, port) -> None:
        self.port  = port
        self.panel = panel

    def run_lt(self) -> None:
        output = os.system(f'lt -p {port}')
        return output

    def start_lt(self) -> None:
        print(
            self.run_lt(port) # give localtunnel link through console
        )

    def main(self) -> None:
        old_run = self.panel.run

        def new_run(*args, **kwargs):
            port = kwargs.get('port', self.port)
            thread = threading.Timer(1, self.start_lt, args=(port,))
            thread.setDaemon(True)
            thread.start()
            old_run(*args, **kwargs)
        self.panel.run = new_run

def start(app) -> None:
    localtunnel = Tunnel(
        port=5000,
        panel=app
    )
    localtunnel.main()
